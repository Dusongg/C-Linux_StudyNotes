

# 无状态/有状态服务

- 有状态服务：与数据打交道，服务器节点自身存放了数据（会话状态，数据库），对客户端提供服务

  <u>有状态服务下，不易于拓展，数据迁移任务量大</u>

  <img src="https://typora-dusong.oss-cn-chengdu.aliyuncs.com/image-20250116%E4%B8%8B%E5%8D%8874419310.png" alt="image-20250116下午74419310" style="zoom:50%;" />

- 无状态服务：每个请求都是独立的，服务可以从外部系统（如数据库）读取信息，而不是从内存中维护状态。

# 分治方式

- 横向：每个节点携带相同的数据

- 纵向：将数据分配到不同节点

- 带权：每个节点根据自己的配置性能分配不同的权重，及接收不同数量的请求

  <img src="https://typora-dusong.oss-cn-chengdu.aliyuncs.com/image-20250116%E4%B8%8B%E5%8D%8874602103.png" alt="image-20250116下午74602103" style="zoom:50%;" />





# 一致性哈希

## 节点入环

对数据的key做哈希再取模之后的位置顺指针找到第一个物理节点就是数据归属的节点

<img src="https://typora-dusong.oss-cn-chengdu.aliyuncs.com/image-20250116%E4%B8%8B%E5%8D%8883932462.png" alt="image-20250116下午83932462" style="zoom:50%;" />

## 数据迁移

- **新增节点**：若新增节点C在A、B之间，则将C中哈希值位于`(A, C]`之间的数据迁移到节点C中
- **删除节点**：将C中节点迁移到B中



## 虚拟节点

为了解决节点分布不均匀而导致的节点数据量分配不均匀问题

<img src="https://typora-dusong.oss-cn-chengdu.aliyuncs.com/image-20250116%E4%B8%8B%E5%8D%8885958261.png" alt="image-20250116下午85958261" style="zoom:50%;" />

## 

- 真实节点：集群中的各个节点，是物理意义上存在的服务器节点
-  虚拟节点：真实节点进入哈希环时使用的一系列代理节点，是逻辑意义上的代理节点

- 带权分治：当某个节点性能较高，对应的虚拟节点可以设置较大些，以分配更多的数据与请求

