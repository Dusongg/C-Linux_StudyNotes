# 1 结构化绑定

```cpp
int main() {
    vector<pair<string, int>> vp{ {"pair1",2}, 
                                 {"pair2", 4}, 
                                 {"pair3", 6} };
    for (auto& [p1, p2] : vp) {
        cout << format("{}: {}   ", p1, p2);
    }
    cout << '\n';
    for (auto& [p1, _] : vp) {
        cout << format("{}: {}   ", p1, "null");
    }
}
```

![image-20240229112927827](https://typora-dusong.oss-cn-chengdu.aliyuncs.com/image-20240229112927827.png)

# 2 std::pmr

`std::pmr` 命名空间是 C++17 中引入的一个命名空间，用于提供基于多态内存资源（Polymorphic Memory Resource, PMR）的内存管理。它的主要目标是为 C++ 标准库的容器和其他数据结构提供灵活的、可定制的内存分配机制。

`std::pmr` 命名空间中的主要组件包括：

1. **内存资源（Memory Resource）**：
    - `std::pmr::memory_resource`：抽象基类，定义了分配和释放内存的方法。用户可以自定义内存资源，通过继承这个基类来实现自己的内存分配策略。
    - `std::pmr::new_delete_resource`：使用全局 `operator new` 和 `operator delete` 的默认内存资源。
    - `std::pmr::null_memory_resource`：一个特殊的内存资源，拒绝所有内存分配请求。
    - `std::pmr::unsynchronized_pool_resource` 和 `std::pmr::synchronized_pool_resource`：基于内存池的内存资源，提供高效的内存管理。

2. **内存资源适配器（Memory Resource Adapters）**：
    - `std::pmr::monotonic_buffer_resource`：一种简单高效的内存资源，适用于短生命周期的内存分配。

3. **容器适配器（Container Adapters）**：
    - 使用 `std::pmr` 命名空间中的容器类型（如 `std::pmr::vector`, `std::pmr::string`, `std::pmr::unordered_map` 等），这些容器与传统容器类似，但它们的内存分配器是基于 `std::pmr::memory_resource` 的。

### 示例代码

以下是一个简单的例子，展示了如何使用 `std::pmr` 命名空间中的内存资源和容器：

```cpp
#include <iostream>
#include <memory_resource>
#include <vector>

int main() {
    // 创建一个内存缓冲区
    char buffer[1024];
    
    // 创建一个基于内存缓冲区的内存资源
    std::pmr::monotonic_buffer_resource pool{buffer, sizeof(buffer)};
    
    // 使用内存资源创建一个向量
    std::pmr::vector<int> vec{&pool};
    
    // 向向量中添加一些元素
    vec.push_back(1);
    vec.push_back(2);
    vec.push_back(3);
    
    // 打印向量中的元素
    for (const auto& elem : vec) {
        std::cout << elem << " ";
    }
    std::cout << std::endl;
    
    return 0;
}
```

在这个例子中，我们首先创建了一个大小为 1024 字节的内存缓冲区，然后使用这个缓冲区创建了一个 `std::pmr::monotonic_buffer_resource` 内存资源。接着，我们使用这个内存资源创建了一个 `std::pmr::vector` 容器，并向其中添加了一些元素。这样，所有向量的内存分配操作都会使用我们提供的内存资源，从而实现定制的内存管理策略。

通过使用 `std::pmr` 命名空间中的组件，开发者可以更灵活地管理内存分配策略，提高程序的性能和内存利用效率。